# ⏰ 定時任務

## 🎯 任務目標

學習如何用自然語言讓 AI 幫你建立自動執行的排程任務，讓工具在背景默默工作。

---

## 💡 為什麼需要定時任務？

| 手動執行（原本） | 自動執行（定時任務） |
|------------------|----------------------|
| ❌ 每天早上手動執行報表 | ✅ 設定一次，自動重複執行 |
| ❌ 每週手動備份檔案 | ✅ 不需要人工介入 |
| ❌ 容易忘記、效率低下 | ✅ 24/7 不間斷運作 |

---

## 💬 範例對話

### 情境 1：每日自動生成報表

**你可以這樣說：**

```
我想建立一個定時任務，每天早上 8 點自動執行，生成昨天的銷售報表，儲存到 reports/ 資料夾
```

**進階要求（可選）：**

```
我用 Windows，用工作排程器來設定
```

```
可以測試看看嗎？執行 python generate_report.py
```

💡 **重點技巧**：
- 明確指定執行時間
- 指定輸出位置
- 先手動測試再設定排程

---

### 情境 2：每週自動備份檔案

**你可以這樣說：**

```
我想每週日晚上 11 點自動備份 documents 資料夾，壓縮後上傳到 Google Drive
```

**進階要求（可選）：**

```
保留最近 4 週的備份，自動清理舊備份
```

```
如果上傳失敗，自動重試 3 次，失敗時寄送通知信
```

---

### 情境 3：每小時監控網頁變化

**你可以這樣說：**

```
我想監控競爭對手的價格，每小時檢查一次，如果價格有變動就通知我
網址是：https://example.com/product/12345
```

**進階要求（可選）：**

```
價格變動時用 Line Notify 即時通知
```

```
記錄歷史價格，可以畫趨勢圖
```

```
可以同時監控多個商品嗎？請提供商品清單 CSV
```

---

### 情境 4：工作日早上發送每日摘要

**你可以這樣說：**

```
我想建立一個每日摘要系統，週一到週五早上 8:30，自動整理以下資訊並寄信給我：
- 昨日銷售數字
- 待處理訂單數量
- 庫存警告（低於 10 件的商品）
```

**進階要求（可選）：**

```
假日自動跳過
```

```
郵件用 HTML 格式，包含圖表和表格
```

```
如果某天資料有問題，顯示警告標記，並使用前一天的數據
```

---

## 🎓 學到的技巧

1. **排程設定**：使用系統工具或程式套件設定定時執行
2. **錯誤處理**：自動重試、記錄日誌、異常通知
3. **資源管理**：避免重複執行、控制資源使用
4. **通知機制**：Email、Line、Slack 等通知整合
5. **日誌記錄**：追蹤執行歷史、除錯問題

---

## 🚀 現在輪到你了！

開啟 Copilot Chat (`Ctrl+I` 或 `Cmd+I`)，試著對話：

### 練習 1：簡單定時報表

```
建立一個定時任務，每天早上 9 點自動生成 Excel 報表，使用 Windows 工作排程器
```

### 練習 2：週期性備份

```
建立每週備份任務，每週日晚上 10 點，自動壓縮並備份 data 資料夾
```

### 練習 3：價格監控

```
建立網頁監控系統，每小時檢查商品價格，價格變動時發送 Email 通知
```

### 練習 4：每日摘要

```
建立每日摘要系統，週一到週五早上 8 點，寄送昨日數據摘要信
```

---

## 💡 提示

### 排程時間設定技巧

**1. 避開尖峰時段**

✅ 好的時間：
- 深夜執行大量資料處理（23:00-05:00）
- 上班前完成報表（07:00-08:00）
- 午休時間執行（12:00-13:00）

❌ 不好的時間：
- 上班時間執行耗資源任務
- 系統備份期間執行

**2. 考慮依賴關係**
```
任務 A：資料收集（每天 01:00）
任務 B：資料分析（每天 02:00）← 依賴 A
任務 C：報表生成（每天 03:00）← 依賴 B
```

**3. 設定合理的間隔**

| 任務類型 | 建議間隔 |
|----------|----------|
| 即時性高的任務 | 每 5-15 分鐘 |
| 一般監控任務 | 每 30-60 分鐘 |
| 資料統計任務 | 每天一次 |
| 備份任務 | 每週一次 |

---

## ⏰ 常見排程設定

### Windows 工作排程器

特點：
- ✅ Windows 內建，不需額外安裝
- ✅ 圖形化介面，容易設定
- ✅ 開機後自動執行

設定方式：
1. 開啟「工作排程器」
2. 建立基本工作
3. 設定觸發條件
4. 設定要執行的程式

### Python schedule 套件

```python
# 簡單易用，適合 Python 專案
import schedule
import time

schedule.every().day.at("09:00").do(job)
schedule.every().hour.do(job)
schedule.every().monday.at("08:30").do(job)

while True:
    schedule.run_pending()
    time.sleep(60)
```

### Cron（Linux/Mac）

```bash
# 分 時 日 月 週 指令
0 9 * * * python /path/to/script.py    # 每天 9:00
0 */2 * * * python script.py           # 每 2 小時
0 8 * * 1 python script.py             # 每週一 8:00
```

---

## 🎯 挑戰任務

### 🥇 初級挑戰
- [ ] 建立每日自動執行的報表生成任務
- [ ] 設定每週備份資料夾
- [ ] 建立簡單的監控腳本

### 🥈 中級挑戰
- [ ] 建立完整的監控系統（價格、庫存、新聞）
- [ ] 實作錯誤重試和通知機制
- [ ] 建立每日摘要郵件系統

### 🥉 高級挑戰
- [ ] 建立多任務排程系統（管理多個定時任務）
- [ ] 實作任務依賴管理（任務 B 等待任務 A）
- [ ] 建立 Web 介面管理排程任務

---

## 🌟 小技巧

### 如何描述排程需求

**範例 1：明確的時間**
```
每天早上 8:30 執行，如果是週末就跳過
```

**範例 2：複雜的觸發條件**
```
每小時檢查一次，但只在上班時間（9:00-18:00），而且只在週一到週五
```

---

## 🛡️ 最佳實踐

### 1. 錯誤處理

```
如果任務執行失敗，記錄錯誤日誌，發送警報通知，自動重試 3 次
```

### 2. 日誌記錄

```
記錄詳細日誌：開始時間、處理的資料量、執行結果、錯誤訊息、結束時間
儲存到：logs/task_YYYY-MM-DD.log
```

### 3. 資源控制

```
檢查是否已在執行，使用 lock 檔案防止重複執行
```

### 4. 通知機制

可以整合多種通知：
- Email（詳細報告）
- Line Notify（即時通知）
- Slack（團隊通知）
- Discord Webhook

---

## 🔧 進階技巧

### 動態調整執行時間

```
可以根據資料量調整執行頻率嗎？資料少就少檢查，資料多就多檢查
```

### 條件式執行

```
只有當某個條件成立時才執行，例如：只有當檔案存在時才處理
```

---

記住：**好的定時任務系統讓工作自動化，讓你專注更重要的事！** ⏰
