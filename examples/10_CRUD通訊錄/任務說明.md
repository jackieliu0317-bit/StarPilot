# 📇 CRUD 通訊錄任務

## 🎯 任務目標

學習如何用自然語言讓 AI 幫你建立一個完整的「通訊錄管理系統」，並連接免費雲端資料庫，實現真正的資料永久儲存。

**什麼是 CRUD？**

| 縮寫 | 英文 | 中文 | 通訊錄範例 |
|------|------|------|------------|
| **C** | Create | 新增 | 新增一位聯絡人 |
| **R** | Read | 讀取 | 查看聯絡人清單 |
| **U** | Update | 更新 | 修改聯絡人資料 |
| **D** | Delete | 刪除 | 刪除一位聯絡人 |

> 💡 **為什麼學這個很重要？**
> CRUD 是所有資料管理系統的基礎，無論是客戶管理、庫存系統、訂單管理，都是 CRUD 的延伸應用！

---

## 🗄️ 免費雲端資料庫介紹

### 為什麼需要雲端資料庫？

| 本地儲存（CSV、JSON） | 雲端資料庫 |
|------------------------|------------|
| ❌ 關閉程式資料可能遺失 | ✅ 資料永久儲存 |
| ❌ 只能單機使用 | ✅ 多人協作共用 |
| ❌ 難以備份和還原 | ✅ 自動備份 |
| ❌ 無法遠端存取 | ✅ 隨時隨地存取 |

### 🌟 推薦平台：Supabase（完全免費！）

**Supabase** 是一個開源的 Firebase 替代方案，基於 PostgreSQL 資料庫。

**免費方案包含**：
- ✅ **500 MB** 資料庫儲存空間
- ✅ **無限** API 請求
- ✅ **50,000** 月活躍用戶
- ✅ **1 GB** 檔案儲存
- ✅ 自動產生 REST API
- ✅ 即時資料同步功能

> ⚠️ **注意**：免費方案專案閒置超過 7 天會暫停，重新訪問即可恢復。

### 其他免費資料庫選項

| 平台 | 類型 | 免費額度 | 適合用途 |
|------|------|----------|----------|
| **Supabase** | PostgreSQL | 500 MB / 無限 API | 完整應用開發（推薦）|
| **Firebase** | NoSQL | 1 GB / 5萬讀取/天 | 即時應用、行動 App |
| **Airtable** | 表格式 | 1,000 筆 / 1 GB | 簡單資料管理 |
| **MongoDB Atlas** | NoSQL | 512 MB | 彈性資料結構 |
| **PlanetScale** | MySQL | 5 GB | 大型專案 |

---

## 📝 Supabase 完整註冊與使用教學

> 💡 **什麼是 Supabase？**
> Supabase 是一個開源的「後端即服務」（Backend as a Service）平台，讓你不用自己架設伺服器，就能擁有：
> - ✅ 資料庫（PostgreSQL）
> - ✅ 自動產生的 API
> - ✅ 使用者認證系統
> - ✅ 即時資料同步
> 
> 簡單說：**它幫你處理所有後端的事情，你只需要專注在前端介面！**

---

### 🔐 步驟 1：註冊 Supabase 帳號

#### 1-1. 前往 Supabase 官網

```
1️⃣ 開啟瀏覽器，前往 https://supabase.com
2️⃣ 你會看到 Supabase 首頁，顯示「Build in a weekend, Scale to millions」
3️⃣ 點擊右上角綠色的「Start your project」按鈕
```

#### 1-2. 選擇登入方式

```
會看到登入頁面，有三種登入方式：

🔘 Continue with GitHub ← 強烈推薦！（一鍵快速，而且專案可直接連結）
🔘 Continue with SSO
🔘 或用 Email 註冊

👉 建議選擇「Continue with GitHub」
   （如果你還沒有 GitHub 帳號，請先到 github.com 註冊）
```

#### 1-3. GitHub 授權

```
1️⃣ 點擊「Continue with GitHub」後
2️⃣ 會跳轉到 GitHub 授權頁面
3️⃣ 頁面會顯示「Authorize Supabase」
4️⃣ 顯示 Supabase 需要存取：
   - 你的公開個人資料（Public profile）
   - 你的電子郵件地址
5️⃣ 點擊綠色的「Authorize supabase」按鈕

✅ 授權完成後，會自動跳轉回 Supabase
```

> 💡 **提醒**：這是正常的授權流程，Supabase 只會讀取你的基本資料，不會修改你的 GitHub 內容。

#### 1-4. 完成新手引導（首次登入）

```
首次登入可能會看到一些問卷問題：

📝 What best describes your role?
   → 隨便選一個，例如「Hobbyist」或「Student」

📝 What are you building?
   → 可以選「Something else」或跳過

📝 How did you hear about us?
   → 隨便選一個

✅ 點擊「Get Started」或「Skip」繼續
```

---

### 🆕 步驟 2：建立新專案

#### 2-1. 進入專案建立頁面

```
1️⃣ 登入後，你會看到「Your Projects」頁面
2️⃣ 如果是新帳號，會看到「Create a new project」提示
3️⃣ 點擊「New Project」按鈕（綠色）
```

#### 2-2. 選擇組織（Organization）

```
1️⃣ 第一次使用會需要建立一個組織
2️⃣ 在「Select an organization」下拉選單中：
   - 如果已有組織，直接選擇
   - 如果沒有，點擊「New organization」建立

📝 建立組織時填寫：
   - Organization name：填「我的學習專案」或任意名稱
   - Type of organization：選「Personal」
   - Pricing Plan：選「Free」（免費方案）
   
   點擊「Create organization」
```

#### 2-3. 填寫專案資訊

```
在「Create a new project」頁面填寫：

📝 Name（專案名稱）
   → 填：contacts-app
   → 或任何你喜歡的英文名稱（小寫，可用連字號）

📝 Database Password（資料庫密碼）
   → 設定一個安全的密碼
   → ⚠️ 請務必記住這個密碼！建議用密碼管理器存起來
   → 或點擊「Generate a password」自動產生

📝 Region（地區）
   → 選擇「Northeast Asia (Tokyo)」
   → 這是離台灣最近的機房，速度最快

📝 Pricing Plan
   → 確認選擇「Free」（免費方案）
```

#### 2-4. 建立專案

```
1️⃣ 確認所有資訊填寫正確
2️⃣ 點擊「Create new project」按鈕
3️⃣ 會看到「Setting up your project」進度畫面
4️⃣ 等待 2-3 分鐘，專案建立完成

⏳ 進度會顯示：
   - Setting up database... ✓
   - Configuring API... ✓
   - Enabling realtime... ✓

✅ 完成後會自動進入專案主控台（Project Dashboard）
```

---

### 🗃️ 步驟 3：建立資料表（Table）

#### 3-1. 進入 Table Editor

```
1️⃣ 在專案主控台左側選單
2️⃣ 點擊「Table Editor」圖示（表格圖案）
3️⃣ 會看到空白的資料表列表
4️⃣ 點擊「Create a new table」按鈕
```

#### 3-2. 設定資料表基本資訊

```
📝 Name（資料表名稱）
   → 填：contacts
   → （小寫英文，這會是 API 路徑的一部分）

📝 Description（描述）
   → 可選填：「我的通訊錄」

☑️ Enable Row Level Security (RLS)
   → ❌ 取消勾選（教學用，先關閉方便測試）
   → 正式上線時建議開啟！
```

> ⚠️ **關於 RLS（Row Level Security）**
> RLS 是資料庫的安全機制，可以控制誰能看到哪些資料。
> 教學階段先關閉，等熟悉後再開啟會更安全！

#### 3-3. 新增欄位（Columns）

點擊「Add column」逐一新增以下欄位：

| 欄位名稱 | Type（類型） | Default Value（預設值） | Primary | 說明 |
|----------|-------------|------------------------|---------|------|
| `id` | `int8` | （系統自動設定） | ✅ | 主鍵，自動遞增 |
| `name` | `text` | - | - | 聯絡人姓名 |
| `phone` | `text` | - | - | 電話號碼 |
| `email` | `text` | - | - | 電子郵件 |
| `company` | `text` | - | - | 公司名稱 |
| `category` | `text` | - | - | 分類標籤 |
| `notes` | `text` | - | - | 備註 |
| `created_at` | `timestamptz` | `now()` | - | 建立時間 |

```
💡 新增欄位步驟：
1️⃣ 點擊「Add column」
2️⃣ 在「Name」填入欄位名稱（如：name）
3️⃣ 在「Type」下拉選單選擇類型（如：text）
4️⃣ 如果需要預設值，在「Default Value」填入
5️⃣ 重複以上步驟，新增所有欄位
```

#### 3-4. 儲存資料表

```
1️⃣ 確認所有欄位設定正確
2️⃣ 點擊右下角的「Save」按鈕
3️⃣ 資料表建立完成！

✅ 現在你有一個空的 contacts 資料表了
```

---

### 🔑 步驟 4：取得 API 連線資訊

#### 4-1. 進入專案設定

```
1️⃣ 點擊左側選單最下方的「Project Settings」（齒輪圖示 ⚙️）
2️⃣ 在設定頁面左側選單，點擊「API」
```

#### 4-2. 複製重要資訊

在 API 設定頁面，你需要複製兩個重要資訊：

```
📋 Project URL（專案網址）
   位置：「Project URL」區塊
   格式：https://xxxxxxxxxx.supabase.co
   
   👉 點擊右邊的「Copy」按鈕複製

📋 API Key（API 金鑰）
   位置：「Project API keys」區塊
   找到「anon public」那一列
   格式：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...（很長一串）
   
   👉 點擊右邊的「Copy」按鈕複製
```

#### 4-3. 保存連線資訊

```
建議把這兩個資訊存到安全的地方：

SUPABASE_URL=https://xxxxxxxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

⚠️ 注意事項：
- 不要把 API Key 直接寫在程式碼裡（尤其是上傳到 GitHub 的程式碼）
- 使用環境變數或 .env 檔案來儲存
- 正式專案請使用 service_role 金鑰搭配 RLS
```

> 🎉 **恭喜！** 你已經完成 Supabase 的基本設定，可以開始寫程式連接資料庫了！

---

### 📊 步驟 5：測試資料表（選擇性）

在寫程式之前，可以先手動新增幾筆測試資料：

```
1️⃣ 回到「Table Editor」
2️⃣ 點擊「contacts」資料表
3️⃣ 點擊右上角的「Insert」→「Insert row」
4️⃣ 填入測試資料：
   - name：王小明
   - phone：0912-345-678
   - email：xiaoming@example.com
   - company：美好科技
   - category：同事
   - notes：每週三開會
5️⃣ 點擊「Save」

✅ 資料新增成功！你可以在表格中看到這筆資料
```

---

### ❗ 常見問題排解

**Q：忘記資料庫密碼怎麼辦？**
```
1️⃣ 進入 Project Settings
2️⃣ 點擊左側「Database」
3️⃣ 找到「Database Password」區塊
4️⃣ 點擊「Reset database password」重設密碼
```

**Q：專案被暫停了（Paused）怎麼辦？**
```
免費方案的專案閒置超過 7 天會自動暫停。
解決方法：進入專案頁面，點擊「Restore project」即可恢復。
```

**Q：可以建立多個專案嗎？**
```
免費方案可以建立最多 2 個活躍專案。
如果需要更多，可以刪除不用的專案，或升級到付費方案。
```

> ⚠️ **重要**：API 金鑰要妥善保管，不要公開分享！

---

## 💬 範例對話

### 情境 1：建立基本通訊錄介面

**你可以這樣說：**

```
我想用 Streamlit 做一個通訊錄管理系統，連接 Supabase 資料庫。
功能需求：
- 新增聯絡人（姓名、電話、Email、公司、備註）
- 顯示所有聯絡人列表
- 可以編輯聯絡人資料
- 可以刪除聯絡人

請幫我完成完整的程式碼，包含 Supabase 連接設定。
```

**AI 會幫你產生**：
- 🤖 完整的 Streamlit 應用程式碼
- 🤖 Supabase 連接設定
- 🤖 CRUD 四大功能實作
- 🤖 友善的使用者介面

---

### 情境 2：加入搜尋功能

**你可以這樣說：**

```
我想在通訊錄加上搜尋功能：
- 可以用姓名搜尋
- 可以用公司搜尋
- 可以用電話搜尋
- 搜尋結果即時顯示
```

---

### 情境 3：加入分類標籤

**你可以這樣說：**

```
我想幫聯絡人加上分類標籤：
- 可以選擇：家人、朋友、同事、客戶、其他
- 可以按照分類篩選聯絡人
- 顯示各分類的聯絡人數量
```

---

### 情境 4：匯出功能

**你可以這樣說：**

```
我想加入匯出功能：
- 可以把所有聯絡人匯出成 CSV
- 可以把所有聯絡人匯出成 Excel
- 下載按鈕要放在頁面右上角
```

---

### 情境 5：批次匯入

**你可以這樣說：**

```
我想加入批次匯入功能：
- 讓使用者上傳 CSV 或 Excel 檔案
- 自動識別欄位對應
- 預覽要匯入的資料
- 確認後批次新增到資料庫
```

---

## 💬 完整對話範例

```
👤：我想用 Streamlit 做一個通訊錄，連接 Supabase 資料庫
🤖：好的！請提供你的 Supabase 專案資訊：
    - Project URL
    - API Key
    我會幫你建立完整的通訊錄系統。

👤：URL 是 https://xxxxx.supabase.co，Key 是 eyJhbG...
🤖：（生成完整的 Streamlit 程式碼，包含：
    - 資料庫連接設定
    - 新增聯絡人表單
    - 聯絡人列表顯示
    - 編輯和刪除功能）

👤：可以加上搜尋功能嗎？
🤖：（加入即時搜尋功能，可按姓名、電話、公司搜尋）

👤：我想讓介面更好看一點
🤖：（美化介面：
    - 加入側邊欄放功能選單
    - 使用卡片式顯示聯絡人
    - 加入圖示和顏色標記）

👤：可以部署到網路上嗎？
🤖：（準備 requirements.txt 和部署說明，
    教你部署到 Streamlit Cloud）
```

---

## 🎓 學到的技巧

完成這個任務後，你會學到：

1. **資料庫概念**
   - 什麼是資料表（Table）
   - 什麼是欄位（Column）和資料列（Row）
   - 什麼是主鍵（Primary Key）

2. **API 操作**
   - 如何使用 API 新增資料（POST）
   - 如何使用 API 讀取資料（GET）
   - 如何使用 API 更新資料（PATCH）
   - 如何使用 API 刪除資料（DELETE）

3. **雲端部署**
   - 如何設定環境變數（保護 API 金鑰）
   - 如何部署到 Streamlit Cloud
   - 如何讓其他人使用你的應用

4. **程式設計模式**
   - 表單驗證（確保資料正確）
   - 錯誤處理（處理網路問題）
   - 狀態管理（記住使用者操作）

---

## 📂 測試資料說明

資料夾中提供了：

| 檔案 | 說明 |
|------|------|
| `sample_contacts.csv` | 10 筆範例聯絡人資料 |
| `sample_contacts.json` | JSON 格式的範例資料 |
| `README.md` | 測試資料使用說明 |

---

## 🎯 挑戰任務

### 🥇 初級挑戰
- [ ] 成功連接 Supabase 資料庫
- [ ] 完成新增聯絡人功能
- [ ] 顯示所有聯絡人列表
- [ ] 完成刪除聯絡人功能

### 🥈 中級挑戰
- [ ] 加入搜尋功能
- [ ] 加入編輯聯絡人功能
- [ ] 加入聯絡人分類標籤
- [ ] 美化介面（卡片式顯示）

### 🥉 高級挑戰
- [ ] 加入批次匯入 CSV/Excel 功能
- [ ] 加入匯出功能
- [ ] 部署到 Streamlit Cloud
- [ ] 加入使用者登入功能（Supabase Auth）

---

## 🌟 小技巧

### 安全性提醒

**❌ 不要這樣做**：
```python
# 把 API 金鑰直接寫在程式碼裡
SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**✅ 應該這樣做**：
```python
# 使用環境變數
import os
SUPABASE_KEY = os.environ.get("SUPABASE_KEY")
```

```
# 在 Streamlit Cloud 設定 Secrets
# 或在 .env 檔案中設定（不要上傳到 GitHub！）
```

### 如何描述 CRUD 需求

**範例 1：新增功能**
```
我想要一個表單，輸入姓名、電話、Email 後，
點擊「新增」按鈕，資料會存到 Supabase 的 contacts 表格
```

**範例 2：讀取功能**
```
我想顯示所有聯絡人，用表格方式呈現，
每列顯示：姓名、電話、Email、公司
可以按照姓名排序
```

**範例 3：更新功能**
```
點擊聯絡人的「編輯」按鈕，
會跳出編輯表單，可以修改資料，
修改完按「儲存」，資料會更新到資料庫
```

**範例 4：刪除功能**
```
點擊聯絡人的「刪除」按鈕，
會先顯示確認對話框：「確定要刪除 XXX 嗎？」
確認後才真的刪除，避免誤刪
```

---

## 🚀 進階功能

### 即時同步

```
我想讓通訊錄支援多人同時使用，
當一個人新增聯絡人，其他人的畫面會自動更新
```

### 歷史記錄

```
我想記錄每次的操作歷史：
- 誰在什麼時間新增了哪位聯絡人
- 誰在什麼時間修改了什麼資料
- 誰在什麼時間刪除了哪位聯絡人
```

### 資料驗證

```
我想加入資料驗證：
- 電話必須是數字，長度 10 位
- Email 必須符合電子郵件格式
- 姓名不可以空白
不符合的話顯示錯誤提示
```

---

## 🔗 相關資源

- [Supabase 官方文件](https://supabase.com/docs)
- [Supabase Python Client](https://supabase.com/docs/reference/python/introduction)
- [Streamlit 文件](https://docs.streamlit.io/)

---

## ❓ 常見問題

### Q：Supabase 免費方案真的夠用嗎？

**A**：對於學習和小型專案絕對夠用！
- 500 MB 可以儲存超過 10 萬筆聯絡人
- 無限 API 請求，不用擔心用量
- 等專案長大再考慮升級

### Q：API 金鑰會不會被盜用？

**A**：只要正確使用就很安全：
1. 使用環境變數存放金鑰
2. 開啟 Row Level Security (RLS) 保護
3. 不要把金鑰上傳到公開的 GitHub

### Q：可以用手機存取嗎？

**A**：可以！Streamlit 應用是響應式設計，
部署後在手機瀏覽器也能正常使用。

### Q：資料會不會不見？

**A**：Supabase 提供自動備份功能，
免費方案也有，資料相對安全。
但建議重要資料還是定期匯出備份。

---

記住：**掌握 CRUD，就掌握了資料管理的核心！** 📇
